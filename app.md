# 動画/画像 手動分類ツール - Web化プロジェクト要件

## 1. プロジェクト概要

### 1.1 現状
現在の「動画/画像 手動分類ツール」は、Python/PyQt6で作成されたデスクトップアプリケーションです。このアプリは動画からフレームを抽出し、それらの画像を「Yes」または「No」に手動で分類するために使用されています。

### 1.2 目的
このプロジェクトの目的は、現行のデスクトップアプリケーションをWebアプリケーションに移行し、VercelまたはGoogle Cloud Runにデプロイすることです。これにより、インストール不要で利用可能になり、複数のデバイスからアクセスできるようになります。

### 1.3 主な機能
- 動画ファイルのアップロードとフレーム抽出
- 複数画像ファイルのアップロードと表示
- 画像の「Yes」「No」による手動分類
- 分類結果のCSV出力
- CSVからの分類結果の読み込み（作業再開機能）
- キーボードショートカットによる操作性向上

## 2. 技術スタック

### 2.1 フロントエンド
- **言語/フレームワーク**: React + TypeScript
- **UIライブラリ**: Material-UI または Tailwind CSS
- **ホスティング**: Vercel

### 2.2 バックエンド
- **言語/フレームワーク**: Python + FastAPI
- **画像処理**: OpenCV
- **ホスティング**: Google Cloud Run

### 2.3 ストレージ
- **ファイルストレージ**: Firebase Storage または Google Cloud Storage

## 3. 機能要件

### 3.1 ファイルアップロード
- 動画ファイル（MP4, AVI, MOV, MKV形式）のアップロード
- 複数の画像ファイル（JPG, PNG, BMP形式）の一括アップロード
- ドラッグ＆ドロップによるアップロード
- アップロード進捗の表示

### 3.2 動画処理
- アップロードされた動画からのフレーム抽出
- フレーム抽出進捗のリアルタイム表示
- 抽出されたフレームの自動保存

### 3.3 画像表示・ナビゲーション
- 画像の一覧表示
- 前の画像/次の画像へのナビゲーション
- キーボードショートカット（左右矢印キー）によるナビゲーション
- 現在の画像番号と総数の表示

### 3.4 画像分類
- 現在表示中の画像を「Yes」または「No」に分類
- キーボードショートカット（Y/Nキー）による分類
- 分類状態の視覚的表示（色分け：緑=Yes、赤=No）
- 未分類画像の識別表示

### 3.5 分類データ管理
- 分類結果のCSVファイルへの出力
- CSVファイルからの分類結果の読み込み（作業再開）
- 分類状況の統計表示（オプション）

### 3.6 ユーザーインターフェース
- レスポンシブデザイン（デスクトップ、タブレット対応）
- シンプルで直感的な操作性
- 統一された視覚デザイン
- 進捗状況や処理状態の明確な表示

## 4. 非機能要件

### 4.1 パフォーマンス
- 大容量動画ファイル（1GB以上）への対応
- 多数の画像（1000枚以上）の効率的な表示
- 画像ロード時間の最適化（サムネイル生成など）
- バックグラウンドでの動画処理

### 4.2 セキュリティ
- 安全なファイルアップロード処理
- ファイルタイプと容量の検証
- クロスサイトリクエストフォージェリ（CSRF）対策
- APIエンドポイントの保護

### 4.3 可用性・信頼性
- 長時間動画処理中のエラー復旧機能
- 処理状態の永続化
- セッション管理によるデータ保持
- ネットワーク接続問題に対する堅牢性

### 4.4 拡張性
- 将来的な機能追加に対応できるモジュラー設計
- 複数ユーザーサポートの基盤作成（オプション）
- APIの柔軟な拡張性

## 5. アーキテクチャ設計

### 5.1 全体構成
- SPAフロントエンド（React）
- RESTful APIバックエンド（FastAPI）
- クラウドストレージ（Firebase/GCS）

### 5.2 データフロー
1. ユーザーがファイルをアップロード
2. バックエンドAPIが処理（動画→フレーム抽出など）
3. 処理済みファイルがクラウドストレージに保存
4. ファイル情報とURLがフロントエンドに返却
5. フロントエンドで画像表示・分類
6. 分類結果がAPIを通じて保存

### 5.3 主要コンポーネント
- **ファイルアップローダー**: ファイルの受け取りと検証
- **動画プロセッサー**: フレーム抽出処理
- **イメージマネージャー**: 画像状態管理
- **分類インターフェース**: ユーザーによる分類操作
- **データエクスポーター**: CSV出力処理

## 6. デプロイ戦略

### 6.1 フロントエンド（Vercel）
- Gitリポジトリと連携したCICD
- 環境変数による設定管理
- 静的ファイルの最適化

### 6.2 バックエンド（Cloud Run）
- Dockerコンテナによるデプロイ
- 自動スケーリング設定
- メモリ使用量の最適化（動画処理用）

### 6.3 ストレージ
- Firebase Security Rulesによるアクセス制御
- プライバシー設定
- 一時ファイルの自動クリーンアップ

## 7. マイルストーン

### フェーズ1: 基本設計と環境構築
- 要件の詳細定義
- アーキテクチャ設計
- 開発環境の構築
- クラウドサービスのセットアップ

### フェーズ2: コア機能実装
- ファイルアップロード機能
- 動画処理・フレーム抽出機能
- 画像表示・ナビゲーション機能
- 基本的なUI実装

### フェーズ3: 分類機能実装
- 画像分類インターフェース
- キーボードショートカット
- 分類状態の管理
- CSV出力/読み込み機能

### フェーズ4: 最適化・テスト・デプロイ
- パフォーマンス最適化
- バグ修正
- ユーザビリティテスト
- 本番環境へのデプロイ

## 8. リスクと対策

### 8.1 技術的リスク
- **大容量ファイル処理**: 分割アップロード、ストリーミング処理
- **処理タイムアウト**: 非同期処理、タスクキュー
- **ブラウザ互換性**: クロスブラウザテスト、ポリフィル

### 8.2 プロジェクト管理リスク
- **スケジュール遅延**: モジュール分割、優先順位付け
- **要件変更**: アジャイル開発手法、柔軟な設計
- **リソース制約**: クラウドリソースの最適化、コスト管理

## 9. 今後の拡張可能性

### 9.1 機能拡張
- ユーザー認証と権限管理
- チーム協業機能
- AI補助による自動分類提案
- 分類カテゴリの拡張（Yes/No以外）

### 9.2 インテグレーション
- 外部サービスとの連携
- API公開によるワークフロー統合
- モバイルアプリ対応

## 10. 成功基準

- デスクトップ版と同等以上の機能提供
- 直感的で使いやすいUI/UX
- スムーズな動画処理と画像表示
- 安定したクラウド運用
- データの正確な保存と取得